<!DOCTYPE html>
<html>
  <head>
    <title>Api Reading Practice</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">

    <!-- Bootstrap CSS from a CDN. This way you don't have to include the bootstrap file yourself -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    
    <!-- Your own stylesheet -->
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body onload="yoooo()" style="background-color: #000000;" >
     <h1 style="text-align: center; color: white; padding: 25px; font-family: Monaco;">Taipei Street</h1>
     <div id="666" style="text-align: center;"></div>
     <div id="777" style="text-align: center; color: white; padding: 25px; font-family: Monaco;"></div>
     <!--button>Find out more</button-->
     <!--button id="bt">Click Me</button-->
     <script type="text/javascript">
     const app = document.getElementById('666');
     const webapp = document.getElementById('777');
     const head = document.createElement('div');
     head.setAttribute('class','head');

     const ragicApiKey = 'V2p1TmhjZG0zUG1QdzMvVEJFL1YvbEVuaHIwWXViV3M4V1VpTmNUam9zVEJ6OXhRZWRSZzZYaWQwbTNzemd0WA==';
    const ragicUrl = 'https://www.ragic.com/guanhou/api-practice/1?v=3&api&where=1013145,eq,00001';
    const yoooo = async function() {
      const urlToFetch = `${ragicUrl}&APIKey=${ragicApiKey}`;
      try{
      const response = await fetch(urlToFetch);
      if(response.ok){
        const jsonResponse = await response.json();
        console.log(jsonResponse["0"]["_subtable_1013151"]);
        let imgName = jsonResponse["0"]["_subtable_1013151"]["1"]["Photo"];
        let imgs = jsonResponse["0"]["_subtable_1013151"]; //new 2021/08/07
        let imageKeysArray = Object.keys(imgs);// 2021/08/07

        for (var i = 0; i < imageKeysArray.length; i++){
          let imgFileName = jsonResponse["0"]["_subtable_1013151"][`${imageKeysArray[i]}`]["Photo"];
          let imgUrl = `https://www.ragic.com/sims/file.jsp?a=guanhou&f=${imgFileName}`;
          let image = document.createElement('img');
          image.src = imgUrl;
          image.width = "800";
          image.padding = '25';
          app.appendChild(image);  
        };//new 2021/08/07

        //let imgUrl = `https://www.ragic.com/sims/file.jsp?a=guanhou&f=${imgName}`;
        //let image = document.createElement('img');
        //image.src = imgUrl;
        //image.width = "800";
        //image.padding = '25';
        //app.appendChild(image);  

        let contentText = jsonResponse["0"]["Content"]; 
        let content = document.createElement('h3');
        content.innerHTML = contentText;
        webapp.appendChild(content);
        console.log(jsonResponse["0"]);     
      
      
    }
  } catch (error) {console.log(error);}
}


     const container = document.createElement('div');
     container.setAttribute('class','container');

     app.appendChild(head);
     app.appendChild(container);
     </script> 
     
  </body>
  
</html>
